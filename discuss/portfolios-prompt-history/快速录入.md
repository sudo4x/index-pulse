# 完善左侧SideBar中 Quick Create 这个MenuButton
## 按钮所在文件
 按钮在这个文件中 @src/app/(main)/dashboard/_components/sidebar/nav-main.tsx
## UI功能描述
 - Quick Create 这个button支持两种激活方式：快捷键和点击，快捷键使用option+Q来唤起
 - 点击后对话框用sheet组件来实现
 - 对话框布局要求如下
  1、sheet用card包围，sheet在左侧弹出，label和表单输入项使用上下布局
  2、有一个投资组合选择列表，用于指定本次录入属于那个投资组合。这里需要从API获取所有组合来填充这个Select组件
  3、有一个文本输入项，支持多行，用于输入快速录入的文本格式，具体格式下面会详细说明
  4、最下方有一个保存和取消按钮，也是上下布局，可以参考TransferDialog的实现
  5、当数据解析失败时，需要在页面中有合适位置来显示解析失败的原因

## 录入格式
    ```
        买入 五粮液 SZ000858 129.06 100.0 白酒目前属于低位 "入一手" 观望 2025-05-20
        买入 五粮液 SZ000858 129.06 100.0 白酒目前属于低位 "入一手" 观望 
        买入 五粮液 - 129.06 100.0 白酒目前属于低位 "入一手" 观望 2025-05-20
        买入 五粮液 - 129.06 100.0 白酒目前属于低位 "入一手" 观望
        买入 五粮液 - 129.06 100.0
        买入 五粮液 - 129.06 100.0 2025-05-20
        合股 五粮液 - 0 10
        拆股 五粮液 - 0 2 2025-05-20
        除权除息 五粮液 - 31.69 2|1 2025-05-20
    ```
    说明：录入数据中，每一行是一条数据，用空格分割。分别有以下几个字段
    第一个：类型（必须要有）：买入，卖出，除权除息，拆股，合股 5种情况
    第二个：股票名称（与股票代码必须二选一，可以两个都有）
    第三个：股票代码（与股票名称必须二选一，可以两个都有），这个可能不填，但是用 - 占位
    第四个：价格/红利（买入，卖出时必须要有，除权除息时与第五个参数二选一，也可以两个都有），买入、卖出时是价格，除权除息时时每10股红利
    第五个：买入数量/卖出数量/多少股合一股/每股拆成多少股/每10股送股|每10股转增（买入/卖出/合股/拆股时必须要有，除权除息时必须是 每10股送股|每10股转增 这种格式，与第四个参数二选一，也可以两个都有有） 分别对应类型为 买入/卖出/合股/拆股/除权除息
    第六个：备注，这个内容可能包含空格，解析时需要考虑这个情况
    第七个：日期，这个可不填，没填的话默认取当前日期，解析时也要注意这个情况

## 解析方法实现
 需要根据上面提到的录入格式和规则说明，实现一个方法来解析输入的内容，然后返回一个数组，数组里的对象类型是 交易表单数据 类型，
 参考 @src/app/(main)/investment/portfolios/_components/transaction-form-types.ts  中的type TransactionFormData
 解析时如果出现失败情况时，中断解析，返回具体那行的错误信息。

 ## 实现批量保存交易记录接口
 参考现有的创建交易记录的接口，实现批量保存交易记录的接口，用于保存上面的 解析方法 解析出来的结果。
 需要注意：
 1、交易记录保存后那些需要同步更新的信息，比如holdings里面的持仓成本，佣金，税费，总买，总卖，总分红之类的信息。
 2、解析结果里面可能不同品种穿插在一起，为了holdings同步更新信息的性能，是否可以按品种分组，就是说一个品种集中更新，然后只需要计算一次成本，佣金等那些信息。这一点你再仔细思考一下是不是这样的，看有没有必要。

 ## 实现UI和批量保存接口的对接
 把上面的UI和新接口的功能串联起来，实现完整的快速录入功能


 补充：
 我有一个地方忘记补充了，股票名称和股票代码是二选一，如果只提供其中一个的话，处理逻辑还不太一样，比如：
 如果只提供 股票名称，那需要到交易记录表里面去查是否已有相同名字的记录，如果有，可以取出股票代码来用，如果没有，就报错。
 如果只提供 股票代码，那就需要用到在线查询接口，通过股票代码来查到股票名称。可参考@src/app/api/stock-prices/route.ts 怎么获取的
 如果两个都提供，那就是直接使用即可。

└── stocks/search/route.ts      # 股票查询API（新增）  这部分必须要吗 会不会跟stock-prices重复了，这两个其实可以整合成一个

 可以，就是stock-price这个命名会不会不太合适了，是否需要改名一下，因为不仅仅只是价格，你再想看看



 修复prompt：
 @src/lib/services/stock-info-resolver.ts
 @src/lib/services/quick-entry-parser.ts
 @src/lib/validators/quick-entry-validator.ts
 @src/app/(main)/dashboard/_components/sidebar/quick-entry-form.tsx
 这几个文件中有一些复杂的太高的lint错误 逐个修复一下

 @src/app/api/transactions/bulk/route.ts 第91行报错 Argument of type 'number' is not assignable to parameter of type 'string'
 @src/lib/services/quick-entry-parser.ts 第259 291 292行有错误
 @src/lib/validators/quick-entry-validator.ts 第183 196 210行有错误


 /api/stock-prices 这个API做了重定向到新的API /api/stock-info，我觉得没必要保留这个重定向， /api/stock-prices可以完全删除，但是你要检查一下以前使用这个API的地方全部要改成新的API

快速录入sheet中
1、不需要要插入示例这个功能
2、录入文本框中字体再小点，然后提示词太长，只需要这样： 示例: 买入 五粮液 SZ000858 129.06 100 白酒目前属于低位，入一手观望
3、选择投资组合Label和Select两个控件之间的空间太近了，录入那边也是，参考一下 @src/app/(main)/investment/portfolios/_components/transfer-dialog.tsx 里面的布局
4、下方的格式说明改成可折叠的，默认是折叠状态，节省空间

{isFormatGuideOpen ? "▼" : "▶"} 这个符号用ChevronDown 和 ChevronRight代替吧
选择投资组合Label和Select两个控件之间的空间太近了，录入那边也是 这个问题并没有解决，你深度思考下是为什么


录入文本框中字体设置成xs，但是看起来并没有生效 
（这是因为空间中有相应是设置字体，可以使用 !text-xs强制覆盖，这边覆盖后觉得太小了，不改了）


银河test这个组合 我录入“买入 五粮液 - 129 100 测试” 报错：找到股票"五粮液"的历史交易记录，请补充股票代码或检查股票名称是否正确
但是真实是有历史交易记录的


symbol-lookup报错了，你参考下其他route获取user的方式，一般是通过@src/lib/auth/get-user.ts的getCurrentUser来获取的。你需要检查一下快速录入需求新增的接口中有没有类似的错误


我录入 ```买入 长江电力 SH600900 27.5 100 测试 ``` 结果持仓里面成本是0，交易记录里面的佣金也没算出来，仔细思考检查下这是什么问题导致的。



@src/app/(main)/dashboard/_components/sidebar/quick-entry-form.tsx 中 有 “解析结果”和“详细信息” 两部分，太占用空间了，统一成一个就好，而且不需要用Card包裹了。
只需要给出成功几条，失败几条，如果有失败给出所败所在行数，我觉得这样就够了。如果录入那个框能够支持显示行数，那就更好了。

解析结果提示格式改成如下,成功的一行，失败的单独一行
成功 7 条
失败 1 条 (第8,10,12行)
