# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

IndexPulse æ˜¯ä¸€ä¸ªåŸºäº Next.js 15 çš„ç°ä»£åŒ–ç®¡ç†åå°æ¨¡æ¿ï¼Œä¸“é—¨ç”¨äºæŒ‡æ•°æŠ•èµ„å’Œè·Ÿè¸ªç³»ç»Ÿã€‚é¡¹ç›®ä½¿ç”¨äº† App Routerã€TypeScriptã€Tailwind CSS v4 å’Œ Shadcn UI ç»„ä»¶åº“ã€‚

## âš¡ æ ¸å¿ƒæŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Next.js 15 (App Router) 
- **è¯­è¨€**: TypeScript (ä¸¥æ ¼æ¨¡å¼)
- **æ ·å¼**: Tailwind CSS v4
- **ç»„ä»¶åº“**: Shadcn UI
- **çŠ¶æ€ç®¡ç†**: Zustand
- **è¡¨å•**: React Hook Form + Zod éªŒè¯
- **æ•°æ®è¡¨æ ¼**: TanStack Table
- **å›¾è¡¨**: Recharts
- **æ‹–æ‹½**: DND Kit
- **æ•°æ®åº“**: Supabase + Drizzle ORM

### ç‰ˆæœ¬è¦æ±‚
- Next.js å¼ºåˆ¶ä½¿ç”¨ v15.4+
- React å¼ºåˆ¶ä½¿ç”¨ v19+
- Tailwind CSS å¼ºåˆ¶ä½¿ç”¨ v4+
- ä¸¥ç¦ä½¿ç”¨ CommonJS æ¨¡å—ç³»ç»Ÿ
- ä¼˜å…ˆä½¿ç”¨ `??` æ›¿ä»£ `||` æ“ä½œç¬¦

## ğŸš€ å¼€å‘å·¥ä½œæµç¨‹

### æ ‡å‡†åŒ–ä»£ç ä¿®æ”¹æµç¨‹ (å¿…é¡»ä¸¥æ ¼æ‰§è¡Œ)

**æ¯æ¬¡æ–°å¢æˆ–ä¿®æ”¹ä»£ç åï¼Œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š**

```bash
# æ­¥éª¤1ï¼šä»£ç æ ¼å¼åŒ– (è§£å†³æ ¼å¼é—®é¢˜)
npm run format

# æ­¥éª¤2ï¼šä¿®å¤ ESLint é—®é¢˜ (è§£å†³ä»£ç è§„èŒƒé—®é¢˜ï¼ŒåŒ…æ‹¬å¯¼å…¥é¡ºåº)
npx eslint --fix src/

# æ­¥éª¤3ï¼šç¼–è¯‘æ£€æŸ¥ (ç¡®ä¿æ— ç±»å‹é”™è¯¯å’Œæ„å»ºé”™è¯¯)
npm run build
```

**ä¸€é”®æ‰§è¡Œï¼ˆæ¨èï¼‰ï¼š**
```bash
npm run format && npx eslint --fix src/ && npm run build
```

**é‡è¦è¯´æ˜ï¼š**
- **é¡ºåºä¸å¯é¢ å€’**ï¼šformat â†’ eslint fix â†’ build
- **æ¯æ­¥éƒ½å¿…é¡»æ‰§è¡Œ**ï¼šä»»ä½•æ­¥éª¤å¤±è´¥éƒ½è¦å…ˆè§£å†³å†ç»§ç»­
- **é€‚ç”¨æ‰€æœ‰åœºæ™¯**ï¼šæ–°å¢åŠŸèƒ½ã€ä¿®å¤ bugã€é‡æ„ä»£ç 

### å¸¸ç”¨å¼€å‘å‘½ä»¤

```bash
# å¼€å‘å’Œæ„å»º
npm run dev           # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (http://localhost:3000)
npm run build         # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start         # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨

# ä»£ç è´¨é‡
npm run lint          # è¿è¡Œ ESLint æ£€æŸ¥
npm run format        # ä½¿ç”¨ Prettier æ ¼å¼åŒ–ä»£ç 
npm run format:check  # æ£€æŸ¥ä»£ç æ ¼å¼

# ä¸»é¢˜é¢„è®¾
npm run generate:presets  # ç”Ÿæˆè‡ªå®šä¹‰ä¸»é¢˜é¢„è®¾æ–‡ä»¶
```

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

### ç›®å½•ç»“æ„ (ç°ä»£åŒ–åˆ†å±‚æ¶æ„)

é¡¹ç›®é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œå°†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æå‡åˆ°é¡¶å±‚ï¼š

```
src/
â”œâ”€â”€ ğŸ“ æ ¸å¿ƒä¸šåŠ¡å±‚ (é¡¶å±‚)
â”‚   â”œâ”€â”€ services/      # ä¸šåŠ¡æœåŠ¡å±‚ (23ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ price-manager/
â”‚   â”‚   â”œâ”€â”€ transaction-handlers/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”œâ”€â”€ utils/         # å·¥å…·å‡½æ•°å±‚ (11ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ style-utils.ts
â”‚   â”‚   â”œâ”€â”€ format-utils.ts
â”‚   â”‚   â”œâ”€â”€ date-utils.ts, time-utils.ts
â”‚   â”‚   â”œâ”€â”€ theme-utils.ts, layout-utils.ts
â”‚   â”‚   â””â”€â”€ transaction-helpers.ts
â”‚   â””â”€â”€ validators/    # æ•°æ®éªŒè¯å±‚ (3ä¸ªæ–‡ä»¶)
â”‚       â”œâ”€â”€ portfolio-validator.ts
â”‚       â”œâ”€â”€ transaction-validator.ts
â”‚       â””â”€â”€ quick-entry-validator.ts
â”œâ”€â”€ ğŸ“ åº”ç”¨åŠŸèƒ½å±‚
â”‚   â”œâ”€â”€ app/          # Next.js App Router é¡µé¢
â”‚   â”‚   â”œâ”€â”€ (main)/dashboard/
â”‚   â”‚   â”œâ”€â”€ (main)/investment/portfolios/
â”‚   â”‚   â””â”€â”€ (main)/auth/
â”‚   â””â”€â”€ components/   # å…¨å±€å…±äº«ç»„ä»¶
â”‚       â”œâ”€â”€ ui/       # Shadcn UI åŸºç¡€ç»„ä»¶
â”‚       â”œâ”€â”€ data-table/
â”‚       â””â”€â”€ layouts/
â””â”€â”€ ğŸ“ åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ lib/          # åŸºç¡€è®¾æ–½æœåŠ¡
    â”‚   â”œâ”€â”€ auth/     # è®¤è¯ç›¸å…³
    â”‚   â”œâ”€â”€ db/       # æ•°æ®åº“é…ç½®
    â”‚   â””â”€â”€ supabase/ # Supabase å®¢æˆ·ç«¯
    â”œâ”€â”€ config/       # åº”ç”¨é…ç½®
    â”œâ”€â”€ stores/       # Zustand çŠ¶æ€ç®¡ç†
    â”œâ”€â”€ hooks/        # è‡ªå®šä¹‰ React hooks
    â”œâ”€â”€ types/        # TypeScript ç±»å‹å®šä¹‰
    â””â”€â”€ navigation/   # å¯¼èˆªé…ç½®
```

### å¯¼å…¥è§„èŒƒ

```typescript
// æ¨èçš„å¯¼å…¥æ–¹å¼
import { PortfolioCalculator } from '@/services';
import { formatCurrency, cn } from '@/utils';
import { PortfolioValidator } from '@/validators';

// æˆ–å…·ä½“è·¯å¾„å¯¼å…¥
import { PortfolioCalculator } from '@/services/portfolio-calculator';
import { cn } from '@/utils/style-utils';
```

### å…³é”®é…ç½®æ–‡ä»¶

- `src/config/app-config.ts` - åº”ç”¨ä¸»è¦é…ç½®
- `src/navigation/sidebar/sidebar-items.ts` - ä¾§è¾¹æ å¯¼èˆªé…ç½®
- `next.config.mjs` - Next.js é…ç½®ï¼ŒåŒ…å«é‡å®šå‘è§„åˆ™
- `components.json` - Shadcn UI ç»„ä»¶é…ç½®

## ğŸ’¼ æŠ•èµ„ç»„åˆç®¡ç†ç³»ç»Ÿ

### æ•°æ®åº“è®¾è®¡ (Supabase + Drizzle ORM)

- **ç”¨æˆ·è¡¨** (`users`) - åŸºäº Supabase Auth
- **æŠ•èµ„ç»„åˆè¡¨** (`portfolios`) - ç”¨æˆ·çš„æŠ•èµ„ç»„åˆ
- **æŒä»“å“ç§è¡¨** (`holdings`) - è‚¡ç¥¨æŒä»“ä¿¡æ¯
- **äº¤æ˜“è®°å½•è¡¨** (`transactions`) - ä¹°å…¥/å–å‡º/åˆè‚¡/æ‹†è‚¡/é™¤æƒé™¤æ¯
- **è½¬è´¦è®°å½•è¡¨** (`transfers`) - èµ„é‡‘è½¬å…¥è½¬å‡º
- **ç»„åˆå¿«ç…§è¡¨** (`portfolio_snapshots`) - å†å²æ•°æ®å­˜å‚¨
- **è‚¡ç¥¨ä»·æ ¼è¡¨** (`stock_prices`) - å®æ—¶è¡Œæƒ…ç¼“å­˜

### æ ¸å¿ƒè®¡ç®—é€»è¾‘

ä½¿ç”¨ `PortfolioCalculator` æœåŠ¡å®ç°è´¢åŠ¡è®¡ç®—ï¼š

- **æŒè‚¡æ•°è®¡ç®—**ï¼šâˆ‘ä¹°å…¥æ•°é‡ + âˆ‘çº¢è‚¡æ•°é‡ + âˆ‘æ‹†è‚¡æ‰€å¢æ•°é‡ - âˆ‘å–å‡ºæ•°é‡ - âˆ‘åˆè‚¡æ‰€å‡æ•°é‡
- **æ‘Šè–„æˆæœ¬**ï¼š(âˆ‘ä¹°å…¥é‡‘é¢ - âˆ‘å–å‡ºé‡‘é¢ - âˆ‘ç°é‡‘è‚¡æ¯) / æŒè‚¡æ•°
- **æŒä»“æˆæœ¬**ï¼šâˆ‘ä¹°å…¥é‡‘é¢ / (âˆ‘ä¹°å…¥æ•°é‡ + âˆ‘çº¢è‚¡æ•°é‡ + âˆ‘æ‹†è‚¡æ‰€å¢æ•°é‡ - âˆ‘åˆè‚¡æ‰€å‡æ•°é‡)
- **æµ®åŠ¨ç›ˆäº**ï¼š(å½“å‰ä»· - æŒä»“æˆæœ¬) Ã— å¤šä»“æŒè‚¡æ•°
- **ç´¯è®¡ç›ˆäº**ï¼šå¤šä»“å¸‚å€¼ - âˆ‘ä¹°å…¥é‡‘é¢ + âˆ‘å–å‡ºé‡‘é¢ + âˆ‘ç°é‡‘è‚¡æ¯

### API æ¥å£

- `/api/portfolios/*` - ç»„åˆ CRUD æ“ä½œ
- `/api/holdings/*` - æŒä»“æ•°æ®æŸ¥è¯¢
- `/api/transactions/*` - äº¤æ˜“è®°å½•ç®¡ç†
- `/api/transfers/*` - è½¬è´¦è®°å½•ç®¡ç†
- `/api/stock-info/*` - å®æ—¶è¡Œæƒ…è·å–

### å®æ—¶è¡Œæƒ…é›†æˆ

é›†æˆè…¾è®¯è´¢ç»æ¥å£è·å–è‚¡ç¥¨å®æ—¶è¡Œæƒ…ï¼š
- æ”¯æŒ Aè‚¡ã€æ¸¯è‚¡ã€ç¾è‚¡ç­‰å¤šå¸‚åœº
- è‡ªåŠ¨ç¼“å­˜æœºåˆ¶ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
- æ‰¹é‡æŸ¥è¯¢ä¼˜åŒ–

## ğŸ¨ UI è®¾è®¡è§„èŒƒ

### ä¸»é¢˜ç³»ç»Ÿ

é¡¹ç›®æ”¯æŒå¤šç§ä¸»é¢˜é¢„è®¾ï¼š
- é»˜è®¤ (Shadcn Neutral)
- Tangerine (æ©˜è‰²ä¸»é¢˜)
- Brutalist (é‡å…½æ´¾é£æ ¼)
- Soft Pop (æŸ”å’Œæµè¡Œè‰²)

ä¸»é¢˜é€šè¿‡ Zustand store ç®¡ç†ï¼Œæ”¯æŒäº®è‰²/æš—è‰²æ¨¡å¼åˆ‡æ¢ã€‚

### é¢œè‰²è§„èŒƒ - æå…¶é‡è¦ï¼

**ã€é¡¹ç›®æ ¸å¿ƒè§†è§‰è§„èŒƒã€‘æ¶¨è·Œç›ˆäºçš„é¢œè‰²æ ‡å‡†ï¼Œå¿…é¡»ä¸¥æ ¼éµå®ˆï¼š**

**ğŸ”´ çº¢æ¶¨ç»¿è·Œ**ï¼š
- è‚¡ä»·ä¸Šæ¶¨ï¼š`text-red-600`
- è‚¡ä»·ä¸‹è·Œï¼š`text-green-600` 
- æ¶¨è·Œå¹…æ­£å€¼ï¼šçº¢è‰²
- æ¶¨è·Œå¹…è´Ÿå€¼ï¼šç»¿è‰²

**ğŸ”´ çº¢ç›ˆç»¿äº**ï¼š
- ç›ˆåˆ©é‡‘é¢ï¼š`text-red-600`
- äºæŸé‡‘é¢ï¼š`text-green-600`
- æ­£æ”¶ç›Šç‡ï¼šçº¢è‰²
- è´Ÿæ”¶ç›Šç‡ï¼šç»¿è‰²

**é‡è¦æé†’**ï¼šè¿™æ˜¯ä¸­å›½è‚¡å¸‚çš„ä¼ ç»Ÿé¢œè‰²æ ‡å‡†ï¼Œä¸æ¬§ç¾å¸‚åœºç›¸åã€‚

## ğŸ“ å¼€å‘è§„èŒƒ

### ä»£ç æ¶æ„è¦æ±‚

**æ–‡ä»¶å¤§å°é™åˆ¶ï¼š**
- TypeScript/JavaScript: ä¸è¶…è¿‡ 300 è¡Œ
- æ¯å±‚ç›®å½•æ–‡ä»¶æ•°: ä¸è¶…è¿‡ 8 ä¸ª

**é¿å…çš„ä»£ç åå‘³é“ï¼š**
- åƒµåŒ– (Rigidity) - éš¾ä»¥å˜æ›´çš„ç³»ç»Ÿ
- å†—ä½™ (Redundancy) - é‡å¤çš„ä»£ç é€»è¾‘
- å¾ªç¯ä¾èµ– (Circular Dependency) - æ¨¡å—é—´ç›¸äº’çº ç¼ 
- è„†å¼±æ€§ (Fragility) - ä¿®æ”¹å¼•å‘æ„å¤–æŸå
- æ™¦æ¶©æ€§ (Obscurity) - æ„å›¾ä¸æ˜çš„ä»£ç 
- æ•°æ®æ³¥å›¢ (Data Clump) - åº”ç»„åˆçš„æ•°æ®é¡¹
- ä¸å¿…è¦çš„å¤æ‚æ€§ (Needless Complexity) - è¿‡åº¦è®¾è®¡

### ç»„ä»¶å¼€å‘è§„èŒƒ

- åŸºäº Shadcn UI è¿›è¡Œç»„ä»¶å¼€å‘
- æ–°ç»„ä»¶æ”¾åœ¨å¯¹åº”åŠŸèƒ½æ¨¡å—çš„ `_components/` ç›®å½•
- å…¨å±€å…±äº«ç»„ä»¶æ”¾åœ¨ `src/components/` ç›®å½•
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- æ”¯æŒå“åº”å¼è®¾è®¡

### æ•°æ®è¡¨æ ¼è§„èŒƒ

ä½¿ç”¨ TanStack Table æ„å»ºå¤æ‚æ•°æ®è¡¨æ ¼ï¼Œæ”¯æŒï¼š
- æ’åºã€è¿‡æ»¤ã€åˆ†é¡µ
- åˆ—æ‹–æ‹½æ’åº
- è¡Œæ‹–æ‹½æ’åº  
- åˆ—æ˜¾ç¤º/éšè—æ§åˆ¶

## ğŸ”§ å·¥å…·é…ç½®

### è·¯å¾„åˆ«å

ä½¿ç”¨ `@/` åˆ«åæŒ‡å‘ `src/` ç›®å½•ï¼Œåœ¨ `tsconfig.json` ä¸­é…ç½®ã€‚

### ä»£ç è´¨é‡å·¥å…·

- ESLint å’Œ Prettier ä¸¥æ ¼é…ç½®
- Husky git hooks å’Œ lint-staged
- éµå¾ª Next.js 15 App Router æœ€ä½³å®è·µ

### é¡µé¢ç»“æ„

**ä»ªè¡¨æ¿é¡µé¢ï¼š**
- Default (`/dashboard/default`) - é»˜è®¤ä»ªè¡¨æ¿
- CRM (`/dashboard/crm`) - å®¢æˆ·å…³ç³»ç®¡ç†
- Finance (`/dashboard/finance`) - è´¢åŠ¡ç®¡ç†

**è®¤è¯ç³»ç»Ÿï¼š**
- v1: `/auth/v1/login`, `/auth/v1/register`
- v2: `/auth/v2/login`, `/auth/v2/register`

**æŠ•èµ„ç»„åˆé¡µé¢ï¼š**
- å¤š Tab ç»„åˆåˆ‡æ¢ç•Œé¢
- ç»„åˆæ¦‚å†µä¿¡æ¯å±•ç¤º
- æŒä»“å“ç§æ•°æ®è¡¨æ ¼
- äº¤æ˜“è®°å½•ç®¡ç†ç•Œé¢
- è½¬è´¦è®°å½•ç®¡ç†ç•Œé¢

## ğŸ“ é‡è¦æé†’

- **å¼ºåˆ¶ç¼–è¯‘æ£€æŸ¥**ï¼šæ¯æ¬¡ä»£ç ä¿®æ”¹åå¿…é¡» `npm run build` é€šè¿‡
- **ç±»å‹å®‰å…¨ä¼˜å…ˆ**ï¼šé¿å…ä½¿ç”¨ `any`ï¼Œå…¨éƒ¨å®šä¹‰å¼ºç±»å‹
- **ä»£ç å¤ç”¨åŸåˆ™**ï¼šå¼€å‘å‰å…ˆæ£€æŸ¥ç°æœ‰å®ç°ï¼Œé¿å…é‡å¤é€ è½®å­
- **æ¶æ„è´¨é‡ç›‘æ§**ï¼šè¯†åˆ«ä»£ç åå‘³é“æ—¶ç«‹å³è¯¢é—®æ˜¯å¦éœ€è¦ä¼˜åŒ–